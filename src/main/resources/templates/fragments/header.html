<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/springsecurity">

<head th:fragment="header-css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle} ?: 'TourNtravels - Your Journey Partner'"></title>
    <meta name="description"
        content="Book your bus tickets with TourNtravels. Experience premium comfort, AI-powered routing, and seamless booking for your journey across India.">
    <meta name="keywords"
        content="TourNtravels, bus booking, online bus ticket, luxury bus, travel, india bus, sleeper bus, volvo bus">
    <meta name="author" content="TourNtravels">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="TourNtravels - Your Journey Partner">
    <meta property="og:description"
        content="Book your bus tickets with TourNtravels. Experience premium comfort, AI-powered routing, and seamless booking.">
    <meta property="og:image" content="/images/og-image.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="TourNtravels - Your Journey Partner">
    <meta property="twitter:description"
        content="Book your bus tickets with TourNtravels. Experience premium comfort, AI-powered routing, and seamless booking.">
    <meta property="twitter:image" content="/images/og-image.jpg">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700&family=Rajdhani:wght@500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/theme-toggle.css}">
    <link rel="stylesheet" th:href="@{/css/enhancements.css}">
    <link rel="stylesheet" th:href="@{/css/visibility-fixes.css?v=8}">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script>
        (function () {
            const theme = localStorage.getItem('bus-reservation-theme') || 'dark';
            document.documentElement.setAttribute('data-theme', theme);
            if (theme === 'light') {
                document.write('<style>body { background-color: #f8fafc !important; } #global-loader { background-color: rgba(255, 255, 255, 0.9) !important; }</style>');
            }
        })();
    </script>
</head>

<body>
    <!-- Global Loader -->
    <div id="global-loader">
        <div class="loader-content">
            <div class="spinner"></div>
            <div class="loader-text">Loading...</div>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark" th:fragment="navbar">
        <div class="container-fluid">
            <a class="navbar-brand" th:href="@{/}"><i class="fa-solid fa-bus"></i> TourNtravels</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center gap-2">
                    <li class="nav-item" sec:authorize="!isAuthenticated()">
                        <a class="nav-btn nav-btn-outline" th:href="@{/}">Home</a>
                    </li>

                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <a class="nav-link" th:href="@{/}">Home</a>
                    </li>

                    <li class="nav-item" sec:authorize="isAuthenticated() and hasRole('USER')"><a class="nav-link"
                            th:href="@{/my-bookings}">My Bookings</a></li>

                    <li class="nav-item" sec:authorize="isAuthenticated() and hasRole('USER')">
                        <a class="nav-link" th:href="@{/loyalty/dashboard}">
                            <i class="fas fa-gift me-1"></i>Loyalty Rewards
                        </a>
                    </li>

                    <li class="nav-item" sec:authorize="isAuthenticated() and hasRole('USER')">
                        <a class="nav-link" th:href="@{/carbon-report}">
                            <i class="fas fa-leaf me-1"></i>Carbon Report
                        </a>
                    </li>



                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <a class="nav-link" th:href="@{/profile}"><i class="fa-solid fa-user-circle me-1"></i>My
                            Account</a>
                    </li>

                    <li class="nav-item" sec:authorize="hasRole('ADMIN')">
                        <a id="openAdminSidebar" class="nav-link" th:href="@{/admin/dashboard}"><i
                                class="fas fa-cog me-1"></i>Admin Panel</a>
                    </li>

                    <li class="nav-item" sec:authorize="!isAuthenticated()">
                        <a class="nav-btn nav-btn-outline" th:href="@{/login}">Login</a>
                    </li>
                    <li class="nav-item" sec:authorize="!isAuthenticated()">
                        <a class="nav-btn nav-btn-primary" th:href="@{/register}">REGISTER</a>
                    </li>

                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <form th:action="@{/logout}" method="post" class="d-inline">
                            <button type="submit" class="btn btn-link nav-link"><i
                                    class="fa-solid fa-right-from-bracket"></i> Logout</button>
                        </form>
                    </li>

                    <!-- Theme Toggle -->
                    <li class="nav-item">
                        <button class="theme-toggle-btn" type="button" aria-label="Toggle theme"
                            title="Toggle dark/light mode">
                            <div class="theme-toggle-icons">
                                <i class="fas fa-moon"></i>
                                <i class="fas fa-sun"></i>
                            </div>
                            <div class="theme-toggle-slider">
                                <i class="fas fa-moon"></i>
                            </div>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <script>
        // Robust Loader Handling
        (function () {
            const loader = document.getElementById('global-loader');

            function hideLoader() {
                if (loader && !loader.classList.contains('loader-hidden')) {
                    loader.classList.add('loader-hidden');
                    setTimeout(() => {
                        loader.style.display = 'none';
                    }, 500);
                }
            }

            // Hide on load
            window.addEventListener('load', hideLoader);

            // Fallback: Hide after 3 seconds max (safety net)
            setTimeout(hideLoader, 3000);

            // Also hide on DOMContentLoaded if load takes too long
            document.addEventListener('DOMContentLoaded', function () {
                setTimeout(hideLoader, 2000); // Give it a bit of time for images, but don't wait forever
            });
        })();
    </script>
</body>

</html>
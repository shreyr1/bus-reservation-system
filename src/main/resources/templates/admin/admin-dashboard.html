<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- Include Header CSS Fragment Content -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - TourNtravels</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- Include Sidebar CSS -->
    <th:block th:replace="~{fragments/admin-sidebar :: admin-sidebar-css}"></th:block>

    <!-- Admin Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/admin-style.css}">
    <link rel="stylesheet" th:href="@{/css/theme-toggle.css}">
</head>

<body>
    <!-- Admin Sidebar Fragment -->
    <div th:replace="~{fragments/admin-sidebar :: admin-sidebar}"></div>

    <!-- Menu Toggle Button (Fixed) -->
    <button class="menu-toggle-btn" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="welcome-text">
                <h1>Admin Dashboard</h1>
                <p>Overview of your system performance</p>
            </div>
            <div class="d-flex gap-3">
                <a href="/" class="btn btn-outline-light rounded-pill px-4">
                    <i class="fas fa-home me-2"></i>Home
                </a>
                <button class="btn btn-primary rounded-pill px-4" onclick="window.print()">
                    <i class="fas fa-download me-2"></i>Report
                </button>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <!-- Total Users -->
            <div class="glass-card card-users">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="stat-label">Total Users</div>
                        <div class="stat-value counter" th:data-target="${totalUsers ?: 0}">0</div>
                    </div>
                    <div class="stat-icon-wrapper">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="mt-3 text-success small">
                    <i class="fas fa-arrow-up me-1"></i>
                    <span>Active & Verified</span>
                </div>
            </div>

            <!-- Total Revenue -->
            <div class="glass-card card-revenue">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value">₹<span class="counter" th:data-target="${totalRevenue ?: 0}">0</span>
                        </div>
                    </div>
                    <div class="stat-icon-wrapper">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                </div>
                <div class="mt-3 text-success small">
                    <i class="fas fa-chart-line me-1"></i>
                    <span>Confirmed Bookings</span>
                </div>
            </div>

            <!-- Total Bookings -->
            <div class="glass-card card-bookings">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="stat-label">Total Bookings</div>
                        <div class="stat-value counter" th:data-target="${totalBookings ?: 0}">0</div>
                    </div>
                    <div class="stat-icon-wrapper">
                        <i class="fas fa-ticket-alt"></i>
                    </div>
                </div>
                <div class="mt-3 text-secondary small">
                    <i class="fas fa-clock me-1"></i>
                    <span>Across all routes</span>
                </div>
            </div>

            <!-- Total Buses -->
            <div class="glass-card card-buses">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="stat-label">Fleet Size</div>
                        <div class="stat-value counter" th:data-target="${totalBuses ?: 0}">0</div>
                    </div>
                    <div class="stat-icon-wrapper">
                        <i class="fas fa-bus"></i>
                    </div>
                </div>
                <div class="mt-3 text-warning small">
                    <i class="fas fa-wrench me-1"></i>
                    <span>Operational</span>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="charts-container">
            <!-- Revenue Chart -->
            <div class="glass-card">
                <div class="chart-header">
                    <h3 class="chart-title">Revenue Analytics</h3>
                    <select class="form-select form-select-sm" style="width: auto;">
                        <option>This Week</option>
                        <option>This Month</option>
                    </select>
                </div>
                <canvas id="revenueChart" height="300"></canvas>
            </div>

            <!-- Quick Actions -->
            <div class="glass-card">
                <div class="chart-header">
                    <h3 class="chart-title">Quick Actions</h3>
                </div>
                <div class="quick-actions">
                    <a href="/admin/buses" class="action-btn">
                        <i class="fas fa-plus-circle"></i>
                        <span>Add Bus</span>
                    </a>
                    <a href="/admin/schedules" class="action-btn">
                        <i class="fas fa-calendar-plus"></i>
                        <span>Add Schedule</span>
                    </a>
                    <a href="/admin/users" class="action-btn">
                        <i class="fas fa-user-plus"></i>
                        <span>Manage Users</span>
                    </a>
                    <a href="/admin/feedback" class="action-btn">
                        <i class="fas fa-comment-dots"></i>
                        <span>Feedback</span>
                    </a>
                </div>

                <div class="mt-4">
                    <h4 class="chart-title mb-3">System Health</h4>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between small mb-1">
                            <span class="text-secondary">Server Load</span>
                            <span class="text-success">24%</span>
                        </div>
                        <div class="progress bg-dark" style="height: 6px;">
                            <div class="progress-bar bg-success" style="width: 24%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex justify-content-between small mb-1">
                            <span class="text-secondary">Database</span>
                            <span class="text-primary">Optimal</span>
                        </div>
                        <div class="progress bg-dark" style="height: 6px;">
                            <div class="progress-bar bg-primary" style="width: 95%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>


    </div>

    <div th:replace="~{fragments/footer :: scripts}"></div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Counter Animation
        const counters = document.querySelectorAll('.counter');
        counters.forEach(counter => {
            const target = +counter.getAttribute('data-target');
            const duration = 1000; // ms
            const increment = target / (duration / 16); // 60fps

            let current = 0;
            const updateCounter = () => {
                current += increment;
                if (current < target) {
                    counter.innerText = Math.ceil(current);
                    requestAnimationFrame(updateCounter);
                } else {
                    counter.innerText = target;
                }
            };
            updateCounter();
        });

        // Revenue Chart with Real Data
        const ctx = document.getElementById('revenueChart').getContext('2d');

        // Get real data from Thymeleaf
        /*<![CDATA[*/
        const dailyRevenueData = /*[[${dailyRevenue}]]*/ {};
        /*]]>*/

        // Prepare data for Chart.js
        const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
        const revenueValues = days.map(day => dailyRevenueData[day] || 0);

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: days,
                datasets: [{
                    label: 'Revenue (₹)',
                    data: revenueValues,
                    borderColor: '#0ea5e9',
                    backgroundColor: 'rgba(14, 165, 233, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#0ea5e9',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                return 'Revenue: ₹' + context.parsed.y.toLocaleString('en-IN');
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)'
                        },
                        ticks: {
                            color: '#94a3b8',
                            callback: function (value) {
                                return '₹' + value.toLocaleString('en-IN');
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: '#94a3b8'
                        }
                    }
                }
            }
        });

        // Fleet Distribution Chart

    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Management - Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Include Sidebar CSS -->
    <th:block th:replace="~{fragments/admin-sidebar :: admin-sidebar-css}"></th:block>
    <!-- Admin Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/admin-style.css}">
    <link rel="stylesheet" th:href="@{/css/theme-toggle.css}">
</head>

<body>
    <!-- Admin Sidebar Fragment -->
    <div th:replace="~{fragments/admin-sidebar :: admin-sidebar}"></div>

    <!-- Menu Toggle Button -->
    <button class="menu-toggle-btn" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="welcome-text">
                <h1>Payment Management</h1>
                <p>Track revenue, refunds, and transaction history</p>
            </div>
            <div class="d-flex gap-3">
                <button class="btn btn-primary rounded-pill px-4">
                    <i class="fas fa-download me-2"></i>Export Report
                </button>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid mb-4">
            <!-- Total Revenue -->
            <div class="glass-card stat-card">
                <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: #10b981;">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="stat-info">
                    <h3 class="stat-value"
                        th:text="'₹' + ${#numbers.formatDecimal(totalRevenue, 0, 'COMMA', 2, 'POINT')}">₹0.00</h3>
                    <p class="stat-label">Total Revenue</p>
                </div>
            </div>

            <!-- Pending Refunds (Placeholder logic) -->
            <div class="glass-card stat-card">
                <div class="stat-icon" style="background: rgba(239, 68, 68, 0.1); color: #ef4444;">
                    <i class="fas fa-undo"></i>
                </div>
                <div class="stat-info">
                    <h3 class="stat-value">0</h3>
                    <p class="stat-label">Pending Refunds</p>
                </div>
            </div>
        </div>

        <!-- Revenue Chart -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glass-card">
                    <h3 class="chart-title mb-4" style="color: var(--text-primary);">Revenue Overview</h3>
                    <div style="height: 300px;">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions Table -->
        <div class="glass-card">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="chart-title mb-0" style="color: var(--text-primary);">Transaction History</h3>
                <div class="d-flex gap-2">
                    <input type="text" class="form-control form-control-sm" placeholder="Search transaction...">
                    <select class="form-select form-select-sm" style="width: auto;">
                        <option>All Types</option>
                        <option>Payment</option>
                        <option>Refund</option>
                    </select>
                </div>
            </div>
            <div class="table-container">
                <table class="custom-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Date</th>
                            <th>User</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="transaction : ${transactions}">
                            <td th:text="'#TRX-' + ${transaction.id}">#TRX-1</td>
                            <td th:text="${#temporals.format(transaction.timestamp, 'dd MMM yyyy, HH:mm')}">Date</td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="avatar-circle me-2"
                                        th:text="${#strings.substring(transaction.user.fullName, 0, 1)}">U</div>
                                    <span th:text="${transaction.user.fullName}">User Name</span>
                                </div>
                            </td>
                            <td>
                                <span class="badge rounded-pill"
                                    th:classappend="${transaction.type == 'PAYMENT'} ? 'bg-success bg-opacity-20 text-success' : 'bg-danger bg-opacity-20 text-danger'"
                                    th:text="${transaction.type}">PAYMENT</span>
                            </td>
                            <td class="fw-bold" th:text="'₹' + ${transaction.amount}">₹100.00</td>
                            <td>
                                <span class="badge rounded-pill bg-success bg-opacity-20 text-success"
                                    th:text="${transaction.status}">SUCCESS</span>
                            </td>
                            <td class="text-muted small" th:text="${transaction.description}">Booking #123</td>
                        </tr>
                        <tr th:if="${transactions.isEmpty()}">
                            <td colspan="7" class="text-center py-4 text-muted">No transactions found</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: scripts}"></div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        const dailyRevenue = /*[[${dailyRevenue}]]*/ {};
        /*]]>*/

        const ctx = document.getElementById('revenueChart').getContext('2d');
        const dates = Object.keys(dailyRevenue).sort();
        const amounts = dates.map(date => dailyRevenue[date]);

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [{
                    label: 'Revenue (₹)',
                    data: amounts,
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#94a3b8' }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#94a3b8' }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: '#94a3b8' }
                    }
                }
            }
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loyalty & Referral Program - Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Include Sidebar CSS -->
    <th:block th:replace="~{fragments/admin-sidebar :: admin-sidebar-css}"></th:block>
    <!-- Admin Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/admin-style.css}">
    <link rel="stylesheet" th:href="@{/css/theme-toggle.css}">
</head>

<body>
    <!-- Admin Sidebar Fragment -->
    <div th:replace="~{fragments/admin-sidebar :: admin-sidebar}"></div>

    <!-- Menu Toggle Button -->
    <button class="menu-toggle-btn" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="welcome-text">
                <h1>Loyalty & Referral Program</h1>
                <p>Manage rewards, points, and referral campaigns</p>
            </div>
            <div class="d-flex gap-2">
                <a href="/admin/dashboard" class="btn btn-outline-light rounded-pill px-4">
                    <i class="fas fa-arrow-left me-2"></i>Back
                </a>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid mb-4">
            <div class="glass-card">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="stat-label">Total Points Awarded</div>
                        <div class="stat-value" th:text="${totalPointsAwarded}">0</div>
                    </div>
                    <div class="stat-icon-wrapper">
                        <i class="fas fa-gift"></i>
                    </div>
                </div>
            </div>

            <div class="glass-card">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="stat-label">Active Users</div>
                        <div class="stat-value" th:text="${users.size()}">0</div>
                    </div>
                    <div class="stat-icon-wrapper">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
            </div>

            <div class="glass-card">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="stat-label">Total Referrals</div>
                        <div class="stat-value" th:text="${totalReferrals}">0</div>
                    </div>
                    <div class="stat-icon-wrapper">
                        <i class="fas fa-user-plus"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <!-- Program Settings -->
            <div class="col-lg-6">
                <div class="glass-card h-100">
                    <div class="chart-header">
                        <h3 class="chart-title">Program Settings</h3>
                    </div>
                    <div class="p-4">
                        <form method="post" th:action="@{/admin/loyalty-program/update-settings}">
                            <div class="mb-4">
                                <h6 class="text-secondary mb-3"><i class="fas fa-coins me-2 text-warning"></i>Points
                                    Configuration</h6>
                                <div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded-3"
                                    style="background: rgba(255,255,255,0.05);">
                                    <span class="text-light">Points per ₹1 spent</span>
                                    <input type="number" name="pointsPerRupee" th:value="${pointsPerRupee}"
                                        class="form-control" style="width: 120px;" required>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded-3"
                                    style="background: rgba(255,255,255,0.05);">
                                    <span class="text-light">Signup Bonus</span>
                                    <input type="number" name="signupBonus" th:value="${signupBonus}"
                                        class="form-control" style="width: 120px;" required>
                                </div>
                                <div class="d-flex justify-content-between align-items-center p-3 rounded-3"
                                    style="background: rgba(255,255,255,0.05);">
                                    <span class="text-light">Referral Bonus</span>
                                    <input type="number" name="referralBonus" th:value="${referralBonus}"
                                        class="form-control" style="width: 120px;" required>
                                </div>
                            </div>

                            <div class="mb-4">
                                <h6 class="text-secondary mb-3"><i class="fas fa-tag me-2 text-success"></i>Redemption
                                    Rates</h6>
                                <div class="d-flex justify-content-between align-items-center p-3 rounded-3"
                                    style="background: rgba(255,255,255,0.05);">
                                    <span class="text-light">Value of 1 Point (₹)</span>
                                    <input type="number" step="0.01" name="redemptionValue"
                                        th:value="${redemptionValue}" class="form-control" style="width: 120px;"
                                        required>
                                </div>
                            </div>

                            <div class="alert alert-info bg-info bg-opacity-10 text-info border-0 mb-3">
                                <i class="fas fa-info-circle me-2"></i>
                                <small>Points are automatically awarded when users complete bookings</small>
                            </div>

                            <div class="text-end">
                                <button type="submit" class="btn btn-primary rounded-pill px-4">
                                    <i class="fas fa-save me-2"></i>Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Top Users -->
            <div class="col-lg-6">
                <div class="glass-card h-100">
                    <div class="chart-header">
                        <h3 class="chart-title">Top Loyalty Members</h3>
                    </div>
                    <div class="table-container">
                        <table class="custom-table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>User</th>
                                    <th>Points</th>
                                    <th>Tier</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="user, iterStat : ${users}" th:if="${iterStat.index < 10}">
                                    <td>
                                        <span class="badge rounded-circle bg-primary"
                                            style="width: 30px; height: 30px; display: inline-flex; align-items: center; justify-content: center;"
                                            th:text="${iterStat.index + 1}">1</span>
                                    </td>
                                    <td>
                                        <div class="fw-bold text-light" th:text="${user.fullName}">User Name</div>
                                        <small class="text-secondary" th:text="${user.email}">email@example.com</small>
                                    </td>
                                    <td>
                                        <span class="badge bg-warning text-dark rounded-pill">
                                            <i class="fas fa-coins me-1"></i><span
                                                th:text="${userPointsMap.get(user.id)}">0</span> pts
                                        </span>
                                    </td>
                                    <td>
                                        <span th:if="${userPointsMap.get(user.id) < 1000}"
                                            class="badge bg-secondary rounded-pill">Silver</span>
                                        <span
                                            th:if="${userPointsMap.get(user.id) >= 1000 && userPointsMap.get(user.id) < 5000}"
                                            class="badge bg-warning text-dark rounded-pill">Gold</span>
                                        <span th:if="${userPointsMap.get(user.id) >= 5000}"
                                            class="badge bg-info text-dark rounded-pill">Platinum</span>
                                    </td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(users)}">
                                    <td colspan="4" class="text-center py-4 text-secondary">
                                        <i class="fas fa-users-slash fa-3x mb-3 d-block opacity-50"></i>
                                        No users yet.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- How It Works -->
        <div class="glass-card mt-4">
            <div class="chart-header">
                <h3 class="chart-title">How the Program Works</h3>
            </div>
            <div class="p-4">
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="text-center p-4 rounded-3" style="background: rgba(79, 70, 229, 0.1);">
                            <div class="icon-box mx-auto mb-3"
                                style="width: 60px; height: 60px; background: rgba(79, 70, 229, 0.2);">
                                <i class="fas fa-ticket-alt text-primary" style="font-size: 1.5rem;"></i>
                            </div>
                            <h5 class="text-white mb-2">1. Book & Earn</h5>
                            <p class="text-secondary small mb-0">Users earn 1 point for every ₹1 spent on bookings</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center p-4 rounded-3" style="background: rgba(16, 185, 129, 0.1);">
                            <div class="icon-box mx-auto mb-3"
                                style="width: 60px; height: 60px; background: rgba(16, 185, 129, 0.2);">
                                <i class="fas fa-user-friends text-success" style="font-size: 1.5rem;"></i>
                            </div>
                            <h5 class="text-white mb-2">2. Refer Friends</h5>
                            <p class="text-secondary small mb-0">Earn 100 bonus points for each successful referral</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center p-4 rounded-3" style="background: rgba(245, 158, 11, 0.1);">
                            <div class="icon-box mx-auto mb-3"
                                style="width: 60px; height: 60px; background: rgba(245, 158, 11, 0.2);">
                                <i class="fas fa-gift text-warning" style="font-size: 1.5rem;"></i>
                            </div>
                            <h5 class="text-white mb-2">3. Redeem Rewards</h5>
                            <p class="text-secondary small mb-0">Convert points to discounts on future bookings</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: scripts}"></div>
    <script>
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Feedback - Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Include Sidebar CSS -->
    <th:block th:replace="~{fragments/admin-sidebar :: admin-sidebar-css}"></th:block>
    <!-- Admin Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/admin-style.css}">
    <link rel="stylesheet" th:href="@{/css/theme-toggle.css}">
</head>

<body>
    <!-- Admin Sidebar Fragment -->
    <div th:replace="~{fragments/admin-sidebar :: admin-sidebar}"></div>

    <!-- Menu Toggle Button -->
    <button class="menu-toggle-btn" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="welcome-text">
                <h1>User Feedback</h1>
                <p>Review and manage customer feedback</p>
            </div>
            <div class="d-flex gap-2">
                <span class="badge bg-dark border border-secondary text-light rounded-pill p-2 px-3">Total: <span
                        th:text="${totalCount}">0</span></span>
                <span class="badge bg-success rounded-pill p-2 px-3">New: <span th:text="${newCount}">0</span></span>
            </div>
        </div>

        <!-- Empty State -->
        <div th:if="${#lists.isEmpty(feedbackList)}" class="glass-card p-5 text-center">
            <i class="fas fa-inbox fa-4x text-secondary mb-3 opacity-50"></i>
            <h4 class="text-light">No Feedback Yet</h4>
            <p class="text-secondary">Feedback from users will appear here</p>
        </div>

        <!-- Feedback Table -->
        <div th:unless="${#lists.isEmpty(feedbackList)}" class="glass-card">
            <div class="chart-header">
                <h3 class="chart-title">Recent Feedback</h3>
            </div>
            <div class="table-container">
                <table class="custom-table">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Subject</th>
                            <th>Rating</th>
                            <th>Message</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="feedback : ${feedbackList}">
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="stat-icon-wrapper"
                                        style="width: 35px; height: 35px; font-size: 0.9rem; margin-bottom: 0; margin-right: 0.75rem; background: rgba(139, 92, 246, 0.2); color: var(--neon-secondary);">
                                        <span
                                            th:text="${#strings.substring(feedback.name, 0, 1).toUpperCase()}">U</span>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-light" th:text="${feedback.name}">Name</div>
                                        <small class="text-secondary" th:text="${feedback.email}">email</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="fw-bold text-light" th:text="${feedback.subject}">Subject</span>
                            </td>
                            <td>
                                <span class="text-warning">
                                    <th:block th:each="i : ${#numbers.sequence(1, feedback.rating)}">
                                        <i class="fas fa-star"></i>
                                    </th:block>
                                    <th:block th:if="${feedback.rating < 5}"
                                        th:each="i : ${#numbers.sequence(feedback.rating + 1, 5)}">
                                        <i class="far fa-star text-secondary"></i>
                                    </th:block>
                                </span>
                            </td>
                            <td>
                                <span class="text-secondary"
                                    th:text="${#strings.abbreviate(feedback.message, 40)}">Message</span>
                            </td>
                            <td>
                                <span class="text-light"
                                    th:text="${#temporals.format(feedback.submittedAt, 'MMM dd, yyyy')}">Date</span>
                            </td>
                            <td>
                                <span th:if="${feedback.status == 'NEW'}"
                                    class="badge bg-success rounded-pill">New</span>
                                <span th:if="${feedback.status == 'READ'}"
                                    class="badge bg-warning text-dark rounded-pill">Read</span>
                                <span th:if="${feedback.status == 'RESOLVED'}"
                                    class="badge bg-secondary rounded-pill">Resolved</span>
                            </td>
                            <td>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-sm btn-outline-primary rounded-circle me-2"
                                        data-bs-toggle="modal"
                                        th:attr="data-bs-target='#feedbackModal' + ${feedback.id}" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <form th:if="${feedback.status != 'RESOLVED'}"
                                        th:action="@{/admin/feedback/{id}/status(id=${feedback.id})}" method="post"
                                        class="d-inline">
                                        <input type="hidden" name="status" value="RESOLVED">
                                        <button type="submit" class="btn btn-sm btn-outline-success rounded-circle"
                                            title="Mark Resolved">
                                            <i class="fas fa-check"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Feedback Detail Modals -->
    <div th:each="feedback : ${feedbackList}">
        <div class="modal fade" th:id="'feedbackModal' + ${feedback.id}" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content glass-card"
                    style="background: #1e293b; border: 1px solid rgba(255,255,255,0.1);">
                    <div class="modal-header border-0">
                        <h5 class="modal-title fw-bold text-light" th:text="${feedback.subject}">Subject</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body text-light">
                        <div class="mb-3 p-3 rounded" style="background: rgba(255,255,255,0.05);">
                            <div class="d-flex justify-content-between mb-2">
                                <strong><i class="fas fa-user me-2 text-primary"></i><span
                                        th:text="${feedback.name}">Name</span></strong>
                                <span class="text-secondary"
                                    th:text="${#temporals.format(feedback.submittedAt, 'MMM dd, HH:mm')}">Date</span>
                            </div>
                            <div class="mb-2">
                                <i class="fas fa-envelope me-2 text-primary"></i><span
                                    th:text="${feedback.email}">Email</span>
                            </div>
                            <div>
                                <span class="text-warning">
                                    <th:block th:each="i : ${#numbers.sequence(1, feedback.rating)}">
                                        <i class="fas fa-star"></i>
                                    </th:block>
                                </span>
                            </div>
                        </div>
                        <div class="mt-3">
                            <h6 class="text-secondary text-uppercase small fw-bold">Message</h6>
                            <p class="mt-2" th:text="${feedback.message}">Message content</p>
                        </div>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-secondary rounded-pill"
                            data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: scripts}"></div>
    <script>
    </script>
</body>

</html>
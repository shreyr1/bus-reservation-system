<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: header-css}"></head>

<body>
    <div th:replace="~{fragments/header :: navbar}"></div>

    <main class="main-content d-flex align-items-center justify-content-center"
        style="min-height: 80vh; padding-top: 80px;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6 col-lg-5 col-xl-4">
                    <div
                        class="glass-card p-4 p-md-5 animate__animated animate__zoomIn position-relative overflow-hidden">

                        <!-- Decorative Background Blur -->
                        <div class="position-absolute top-0 start-50 translate-middle bg-primary rounded-circle"
                            style="width: 150px; height: 150px; filter: blur(60px); opacity: 0.2;"></div>

                        <div class="text-center mb-5 position-relative">
                            <div class="icon-box mx-auto mb-4" style="width: 80px; height: 80px; font-size: 2rem;">
                                <i class="fas fa-user text-gradient"></i>
                            </div>
                            <h2 class="fw-bold mb-2 text-white">Welcome <span class="text-gradient">Back</span></h2>
                            <p class="text-muted-light">Login to manage your bookings</p>
                        </div>

                        <div th:if="${param.error}"
                            class="alert alert-danger glass-card border-danger animate__animated animate__shakeX d-flex align-items-center py-2">
                            <i class="fas fa-exclamation-circle me-2 text-danger"></i>
                            <span class="small">Invalid email or password.</span>
                        </div>
                        <div th:if="${param.logout}"
                            class="alert alert-success glass-card border-success animate__animated animate__fadeIn d-flex align-items-center py-2">
                            <i class="fas fa-check-circle me-2 text-success"></i>
                            <span class="small">You have been logged out.</span>
                        </div>

                        <form method="post" th:action="@{/login}" class="auth-form">
                            <div class="mb-4 animate__animated animate__fadeInUp animate__delay-1s">
                                <label for="username"
                                    class="form-label fw-bold small text-uppercase ls-1 text-white">Email
                                    Address</label>
                                <div class="input-wrapper p-0 border-0 bg-transparent">
                                    <i class="fas fa-envelope icon text-primary-light" style="left: 1rem;"></i>
                                    <input type="email" class="form-control ps-5" id="username" name="username"
                                        placeholder="name@example.com" required autofocus>
                                </div>
                            </div>

                            <div class="mb-5 animate__animated animate__fadeInUp animate__delay-2s">
                                <label for="password"
                                    class="form-label fw-bold small text-uppercase ls-1 text-white">Password</label>
                                <div class="input-wrapper p-0 border-0 bg-transparent">
                                    <i class="fas fa-lock icon text-primary-light" style="left: 1rem;"></i>
                                    <input type="password" class="form-control ps-5" id="password" name="password"
                                        placeholder="••••••••" required>
                                </div>
                            </div>

                            <div class="d-grid animate__animated animate__fadeInUp animate__delay-3s">
                                <button type="submit" class="btn btn-primary btn-lg shadow-lg">
                                    LOGIN <i class="fas fa-arrow-right ms-2"></i>
                                </button>
                            </div>
                        </form>

                        <div class="text-center mt-4">
                            <p class="text-muted-light mb-3">Or continue with</p>
                            <div id="g_id_onload"
                                data-client_id="620955088183-tij94kk3m0sp0ui6h1of74fkcaloflf2.apps.googleusercontent.com"
                                data-context="signin" data-ux_mode="popup" data-callback="handleCredentialResponse"
                                data-auto_prompt="false" data-scope="email profile openid">
                            </div>

                            <div class="g_id_signin" data-type="standard" data-shape="rectangular"
                                data-theme="filled_blue" data-text="signin_with" data-size="large"
                                data-logo_alignment="left" data-width="100%">
                            </div>
                        </div>

                        <div class="mt-5 text-center animate__animated animate__fadeIn animate__delay-4s">
                            <p class="text-muted-light mb-0">Don't have an account?
                                <a th:href="@{/register}" class="text-gradient fw-bold ms-1"
                                    style="text-decoration: none;">Register Now</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        function handleCredentialResponse(response) {
            // Send the credential to your backend
            fetch('/auth/google', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'credential=' + response.credential
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        window.location.href = data.redirectUrl;
                    } else {
                        alert('Google login failed. Please try again.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred during Google login.');
                });
        }
    </script>
    <div th:replace="~{fragments/footer :: scripts}"></div>
</body>

</html>
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: header-css}"></head>

<body>
    <div th:replace="~{fragments/header :: navbar}"></div>

    <main class="main-content d-flex align-items-center justify-content-center"
        style="min-height: 80vh; padding-top: 80px;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6 col-lg-5 col-xl-4">
                    <div
                        class="glass-card p-4 p-md-5 animate__animated animate__zoomIn position-relative overflow-hidden">

                        <!-- Decorative Background Blur -->
                        <div class="position-absolute top-0 start-50 translate-middle bg-secondary rounded-circle"
                            style="width: 150px; height: 150px; filter: blur(60px); opacity: 0.2;"></div>

                        <div class="text-center mb-5 position-relative">
                            <div class="icon-box mx-auto mb-4" style="width: 80px; height: 80px; font-size: 2rem;">
                                <i class="fas fa-user-plus text-gradient"></i>
                            </div>
                            <h2 class="fw-bold mb-2 text-white">Create <span class="text-gradient">Account</span></h2>
                            <p class="text-muted-light">Join us for a seamless travel experience</p>
                        </div>

                        <div th:if="${param.success}"
                            class="alert alert-success glass-card border-success animate__animated animate__fadeIn d-flex align-items-center py-2">
                            <i class="fas fa-check-circle me-2 text-success"></i>
                            <span class="small">Registration successful! Please login.</span>
                        </div>

                        <form method="post" th:action="@{/register}" th:object="${userDto}" class="auth-form">
                            <div class="mb-4 animate__animated animate__fadeInUp animate__delay-1s">
                                <label for="fullName"
                                    class="form-label fw-bold small text-uppercase ls-1 text-muted-light">Full
                                    Name</label>
                                <div class="input-wrapper p-0 border-0 bg-transparent">
                                    <i class="fas fa-user icon text-secondary" style="left: 1rem;"></i>
                                    <input type="text" class="form-control ps-5" id="fullName" th:field="*{fullName}"
                                        placeholder="John Doe" required>
                                </div>
                                <p th:if="${#fields.hasErrors('fullName')}" th:errors="*{fullName}"
                                    class="text-danger small mt-1"></p>
                            </div>

                            <div class="mb-4 animate__animated animate__fadeInUp animate__delay-2s">
                                <label for="email"
                                    class="form-label fw-bold small text-uppercase ls-1 text-muted-light">Email
                                    Address</label>
                                <div class="input-wrapper p-0 border-0 bg-transparent">
                                    <i class="fas fa-envelope icon text-secondary" style="left: 1rem;"></i>
                                    <input type="email" class="form-control ps-5" id="email" th:field="*{email}"
                                        placeholder="name@example.com" required>
                                </div>
                                <p th:if="${#fields.hasErrors('email')}" th:errors="*{email}"
                                    class="text-danger small mt-1"></p>
                            </div>

                            <div class="mb-5 animate__animated animate__fadeInUp animate__delay-3s">
                                <label for="password"
                                    class="form-label fw-bold small text-uppercase ls-1 text-muted-light">Password</label>
                                <div class="input-wrapper p-0 border-0 bg-transparent">
                                    <i class="fas fa-lock icon text-secondary" style="left: 1rem;"></i>
                                    <input type="password" class="form-control ps-5" id="password"
                                        th:field="*{password}" placeholder="••••••••" required>
                                </div>
                                <p th:if="${#fields.hasErrors('password')}" th:errors="*{password}"
                                    class="text-danger small mt-1"></p>
                            </div>

                            <div class="mb-4 animate__animated animate__fadeInUp animate__delay-4s">
                                <label for="referralCode"
                                    class="form-label fw-bold small text-uppercase ls-1 text-white">Referral
                                    Code <span class="text-muted-light">(Optional)</span></label>
                                <div class="input-wrapper p-0 border-0 bg-transparent">
                                    <i class="fas fa-gift icon text-warning" style="left: 1rem;"></i>
                                    <input type="text" class="form-control ps-5" id="referralCode"
                                        th:field="*{referralCode}"
                                        placeholder="Enter referral code to get bonus points">
                                </div>
                                <small class="text-success mt-1 d-block">
                                    <i class="fas fa-star me-1"></i>Get 50 bonus points + your friend gets 100 points!
                                </small>
                            </div>

                            <div class="d-grid animate__animated animate__fadeInUp animate__delay-5s">
                                <button type="submit" class="btn btn-primary btn-lg shadow-lg">
                                    REGISTER <i class="fas fa-user-plus ms-2"></i>
                                </button>
                            </div>
                        </form>

                        <div class="text-center mt-4">
                            <p class="text-muted-light mb-3">Or sign up with</p>
                            <div id="g_id_onload"
                                data-client_id="620955088183-tij94kk3m0sp0ui6h1of74fkcaloflf2.apps.googleusercontent.com"
                                data-context="signup" data-ux_mode="popup" data-callback="handleCredentialResponse"
                                data-auto_prompt="false">
                            </div>

                            <div class="g_id_signin" data-type="standard" data-shape="rectangular"
                                data-theme="filled_blue" data-text="signup_with" data-size="large"
                                data-logo_alignment="left" data-width="100%">
                            </div>
                        </div>

                        <div class="mt-5 text-center animate__animated animate__fadeIn animate__delay-5s">
                            <p class="text-muted-light mb-0">Already have an account?
                                <a th:href="@{/login}" class="text-gradient fw-bold position-relative"
                                    style="text-decoration: none;">
                                    Login Here
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        function handleCredentialResponse(response) {
            // Send the credential to your backend
            fetch('/auth/google', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'credential=' + response.credential
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        window.location.href = data.redirectUrl;
                    } else {
                        alert('Google signup failed. Please try again.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred during Google signup.');
                });
        }
    </script>
    <div th:replace="~{fragments/footer :: scripts}"></div>
</body>

</html>